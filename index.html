<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Эхо Древних</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .hidden {
      opacity: 0;
      z-index: -1;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .hidden:not(.visible) {
      display: none;
    }

    .visible {
      opacity: 1;
      display: block;
    }

    button {
      padding: 10px 20px;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
      width: 200px;
    }

    .menu-button {
      display: block;
      margin: 10px auto;
    }

    #splash-dev {
      font-size: 2em;
      position: fixed;
      top: 30vh;
      width: 100%;
      transition: opacity 0.5s ease;
      z-index: 10;
    }

    #splash-dev img {
      display: block;
      width: 200px;
      height: 200px;
      object-fit: contain;
      margin: 20px auto 0;
    }

    #splash-title {
      font-size: 2em;
      position: fixed;
      top: 40vh;
      width: 100%;
      transition: opacity 0.5s ease;
      z-index: 10;
    }

    #main-menu {
      z-index: 5;
      transition: opacity 0.5s ease;
    }

    #about-screen, #class-selection, #game-screen {
      z-index: 5;
      transition: opacity 0.5s ease;
    }

    #travel-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.5s ease;
      z-index: 20;
    }

    #travel-screen.visible {
      opacity: 1;
      display: flex;
    }

    #travel-timer {
      font-size: 1.5em;
      color: #f0f0f0;
    }

    #location-desc {
      padding: 0 5px;
      text-align: justify;
    }

    #location-buttons button {
      margin: 2px;
    }

    .class-option {
      cursor: pointer;
      margin: 10px auto;
      width: 80%;
      padding: 10px;
      border: 1px solid #666;
      background-color: #222;
      transition: background-color 0.3s ease, border-color 0.3s ease;
    }

    .class-option.selected {
      background-color: #333;
      border-color: #888;
    }

    #extra-content {
      width: 80%;
      margin: 0 auto;
    }

    .section-title {
      margin-top: 15px;
      font-weight: bold;
      cursor: pointer;
      display: block;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .section-title::after {
      content: "\25BC";
      display: inline-block;
      margin-left: 5px;
      transition: transform 0.3s ease;
    }

    .section-title.open::after {
      transform: rotate(180deg);
    }

    .section-content {
      margin-bottom: 10px;
      font-size: 0.95em;
      color: #ccc;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .section-content.hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div id="splash-dev">
    Murmyak Games
    <img src="logo.png" alt="Murmyak Games Logo">
  </div>
  <div id="splash-title" class="hidden">Эхо Древних</div>

  <div id="main-menu" class="hidden">
    <h1>Эхо Древних</h1>
    <div class="menu-button">
      <button onclick="newGame()">Новая игра</button>
    </div>
    <div class="menu-button">
      <button onclick="continueGame()">Продолжить игру</button>
    </div>
    <div class="menu-button">
      <button onclick="showAbout()">Об игре</button>
    </div>
  </div>

  <div id="about-screen" class="hidden">
    <h2>Об игре</h2>
    <p>by merzlyakov</p>
    <button onclick="backToMenu()">Назад</button>
  </div>

  <div id="class-selection" class="hidden">
    <h2>Выберите класс</h2>
    <div class="class-option" onclick="toggleClassInfo('archer')">
      <strong>Лучник</strong>
      <div id="archer-info" class="hidden">
        Мастер дальнего боя. Снаряжение: лук, кожаная броня, кольчужный капюшон.
      </div>
    </div>
    <div class="class-option" onclick="toggleClassInfo('warrior')">
      <strong>Воин</strong>
      <div id="warrior-info" class="hidden">
        Сильный и выносливый. Снаряжение: меч, щит, стальная броня.
      </div>
    </div>
    <div class="class-option" onclick="toggleClassInfo('rogue')">
      <strong>Плут</strong>
      <div id="rogue-info" class="hidden">
        Ловкий и скрытный. Снаряжение: кинжалы, плащ теней, маска.
      </div>
    </div>
    <button onclick="selectClass()">Выбрать</button>
  </div>

  <div id="game-screen" class="hidden">
    <h2 id="location-name"></h2>
    <p id="location-desc"></p>
    <div id="location-buttons"></div>
    <div id="extra-content"></div>
  </div>

  <div id="travel-screen" class="hidden">
    <div id="travel-timer">Вы идёте...</div>
  </div>

  <script>
    // Сброс всех экранов
    function resetScreens() {
      document.querySelectorAll("#splash-dev, #splash-title, #main-menu, #about-screen, #class-selection, #game-screen, #travel-screen")
        .forEach(el => {
          el.classList.remove("visible");
          el.classList.add("hidden");
        });
    }

    // Splash-экраны
    resetScreens();
    document.getElementById("splash-dev").classList.remove("hidden");
    document.getElementById("splash-dev").classList.add("visible");

    setTimeout(() => {
      document.getElementById("splash-dev").classList.remove("visible");
      document.getElementById("splash-dev").classList.add("hidden");
      setTimeout(() => {
        resetScreens();
        document.getElementById("splash-title").classList.remove("hidden");
        document.getElementById("splash-title").classList.add("visible");
        setTimeout(() => {
          document.getElementById("splash-title").classList.remove("visible");
          document.getElementById("splash-title").classList.add("hidden");
          setTimeout(() => {
            resetScreens();
            document.getElementById("main-menu").classList.remove("hidden");
            document.getElementById("main-menu").classList.add("visible");
          }, 500); // Задержка для завершения анимации
        }, 3000); // Длительность splash-title
      }, 500); // Задержка для завершения анимации splash-dev
    }, 3000); // Длительность splash-dev

    // Состояние игры
    let playerData = {
      class: null,
      location: "Деревня"
    };

    // Расстояния от Деревни
    const locationDistances = {
      "Деревня": 0,
      "Лес": 1,
      "Река": 1,
      "Горы": 2,
      "Поляна": 2,
      "Пещера": 2,
      "Развалины": 3,
      "Башня": 3,
      "Храм": 4,
      "Портал": 5,
      "Озеро": 2,
      "Болото": 3,
      "Каньон": 3,
      "Равнина": 4,
      "Крепость": 5
    };

    // Названия локаций в винительном падеже
    const locationAccusative = {
      "Деревня": "Деревню",
      "Лес": "Лес",
      "Река": "Реку",
      "Горы": "Горы",
      "Поляна": "Поляну",
      "Пещера": "Пещеру",
      "Развалины": "Развалины",
      "Башня": "Башню",
      "Храм": "Храм",
      "Портал": "Портал",
      "Озеро": "Озеро",
      "Болото": "Болото",
      "Каньон": "Каньон",
      "Равнина": "Равнину",
      "Крепость": "Крепость"
    };

    // Классы
    function toggleClassInfo(id) {
      const el = document.getElementById(id + "-info");
      el.classList.toggle("hidden");
      // Управление классом selected
      const options = document.querySelectorAll(".class-option");
      options.forEach(opt => opt.classList.remove("selected"));
      if (!el.classList.contains("hidden")) {
        el.parentElement.classList.add("selected");
      }
    }

    function newGame() {
      playerData = { class: null, location: "Деревня" };
      resetScreens();
      document.getElementById("class-selection").classList.remove("hidden");
      document.getElementById("class-selection").classList.add("visible");
      // Сброс выделения
      document.querySelectorAll(".class-option").forEach(opt => opt.classList.remove("selected"));
    }

    function continueGame() {
      const data = localStorage.getItem("mygame-save");
      if (data) {
        playerData = JSON.parse(data);
        startGame();
      } else {
        alert("Сохранённой игры не найдено. Начните новую игру.");
      }
    }

    function showAbout() {
      resetScreens();
      document.getElementById("about-screen").classList.remove("hidden");
      document.getElementById("about-screen").classList.add("visible");
    }

    function backToMenu() {
      resetScreens();
      document.getElementById("main-menu").classList.remove("hidden");
      document.getElementById("main-menu").classList.add("visible");
    }

    function selectClass() {
      if (!playerData.class) {
        const selected = ["archer", "warrior", "rogue"].find(id =>
          !document.getElementById(id + "-info").classList.contains("hidden")
        );
        playerData.class = selected || "warrior";
      }
      resetScreens();
      startGame();
    }

    function startGame() {
      resetScreens();
      document.getElementById("game-screen").classList.remove("hidden");
      document.getElementById("game-screen").classList.add("visible");
      updateLocation();
    }

    function saveGame() {
      localStorage.setItem("mygame-save", JSON.stringify(playerData));
    }

    function showTravelScreen(targetLocation, duration) {
      resetScreens();
      const travelScreen = document.getElementById("travel-screen");
      const travelTimer = document.getElementById("travel-timer");
      travelScreen.classList.remove("hidden");
      travelScreen.classList.add("visible");
      let timeLeft = Math.ceil(duration / 1000);
      travelTimer.innerText = `Вы идёте в ${locationAccusative[targetLocation]}... ${timeLeft} сек`;

      const interval = setInterval(() => {
        timeLeft--;
        if (timeLeft > 0) {
          travelTimer.innerText = `Вы идёте в ${locationAccusative[targetLocation]}... ${timeLeft} сек`;
        } else {
          clearInterval(interval);
          playerData.location = targetLocation;
          saveGame();
          resetScreens();
          document.getElementById("game-screen").classList.remove("hidden");
          document.getElementById("game-screen").classList.add("visible");
          updateLocation();
        }
      }, 1000);
    }

    // Локации
    const locations = {
      "Деревня": {
        desc: "Тихая деревня, окружённая старыми дубами. Каменные дома хранят истории о древних героях, а в таверне шепчутся о проклятых землях.",
        paths: ["Лес", "Река"],
        characters: ["Староста Лем", "Кузнец Бран"],
        monsters: []
      },
      "Лес": {
        desc: "Тёмный лес, где ветви сплетаются в узоры. Туман скрывает тропы, а шорохи намекают на присутствие духов.",
        paths: ["Деревня", "Горы", "Поляна"],
        characters: ["Охотница Элира"],
        monsters: ["Древесный ужас", "Тенелис"]
      },
      "Река": {
        desc: "Река с ледяной водой, чьи волны поют о забытых богах. На берегу видны следы древних алтарей.",
        paths: ["Деревня", "Пещера", "Озеро"],
        characters: ["Рыбак Нор"],
        monsters: ["Водяная тварь"]
      },
      "Горы": {
        desc: "Суровые горы, чьи вершины касаются звёзд. Скалы хранят эхо битв давно ушедших времён.",
        paths: ["Лес", "Развалины", "Каньон"],
        characters: [],
        monsters: ["Горный голем"]
      },
      "Поляна": {
        desc: "Лунная поляна, где свет звёзд создаёт магические узоры. Здесь время замирает, а духи шепчут пророчества.",
        paths: ["Лес", "Башня"],
        characters: ["Мудрец Айрен"],
        monsters: []
      },
      "Пещера": {
        desc: "Мрачная пещера, где сталактиты блестят, как клыки. В глубине слышны стоны заточённых теней.",
        paths: ["Река", "Развалины", "Болото"],
        characters: [],
        monsters: ["Слизень", "Пещерный паук"]
      },
      "Развалины": {
        desc: "Останки древнего города, где ветер несёт отголоски былой славы. Камни хранят следы магических рун.",
        paths: ["Горы", "Пещера", "Храм"],
        characters: [],
        monsters: ["Призрак легиона"]
      },
      "Башня": {
        desc: "Одинокая башня, окружённая вихрями эфира. Её стены хранят тайны последнего мага.",
        paths: ["Поляна", "Храм"],
        characters: ["Страж башни Ролан"],
        monsters: []
      },
      "Храм": {
        desc: "Храм, чьи колонны покрыты мхом. Внутри горит вечный огонь, охраняемый невидимыми стражами.",
        paths: ["Башня", "Развалины", "Портал", "Крепость"],
        characters: [],
        monsters: ["Служитель Тени"]
      },
      "Портал": {
        desc: "Круг камней, излучающий неземной свет. Портал манит в иные миры, но его стражи не терпят слабых.",
        paths: ["Храм"],
        characters: [],
        monsters: ["Страж Бездны"]
      },
      "Озеро": {
        desc: "Спокойное озеро, чья гладь отражает звёзды. В глубинах таятся древние реликвии и их хранители.",
        paths: ["Река", "Болото"],
        characters: ["Старец Вейн"],
        monsters: ["Озёрный дух"]
      },
      "Болото": {
        desc: "Гнилое болото, где тени танцуют в тумане. Трясина скрывает кости тех, кто искал запретные сокровища.",
        paths: ["Озеро", "Пещера"],
        characters: [],
        monsters: ["Болотный призрак", "Гнилец"]
      },
      "Каньон": {
        desc: "Красный каньон, высеченный ветрами веков. Его стены покрыты знаками древних племён.",
        paths: ["Горы", "Равнина"],
        characters: ["Скиталец Кайр"],
        monsters: ["Песчаный ящер"]
      },
      "Равнина": {
        desc: "Бескрайняя равнина, где травы шепчут о забытых битвах. Вдалеке виднеются силуэты древних курганов.",
        paths: ["Каньон", "Крепость"],
        characters: [],
        monsters: ["Степной волк"]
      },
      "Крепость": {
        desc: "Полуразрушенная крепость, чьи башни всё ещё стоят. В её залах звучат отголоски рыцарских клятв.",
        paths: ["Равнина", "Храм"],
        characters: ["Комендант Рейн"],
        monsters: ["Оживший доспех"]
      }
    };

    function updateLocation() {
      const loc = playerData.location;
      const data = locations[loc];
      document.getElementById("location-name").innerText = loc;
      document.getElementById("location-desc").innerText = data.desc;

      const buttons = document.getElementById("location-buttons");
      buttons.innerHTML = "";

      data.paths.forEach(path => {
        const btn = document.createElement("button");
        btn.innerText = path;
        btn.onclick = () => {
          const distance = locationDistances[path];
          const travelTime = Math.min(distance * 5000, 15000); // расстояние * 5 сек, максимум 15 сек
          showTravelScreen(path, travelTime);
        };
        buttons.appendChild(btn);
      });

      const extraContent = document.getElementById("extra-content");
      extraContent.innerHTML = "";

      if (data.characters.length > 0) {
        const charTitle = document.createElement("div");
        charTitle.className = "section-title";
        charTitle.innerText = "Персонажи";
        const content = document.createElement("div");
        content.className = "section-content hidden";

        data.characters.forEach(name => {
          const p = document.createElement("div");
          p.innerText = name;
          content.appendChild(p);
        });

        charTitle.onclick = () => {
          content.classList.toggle("hidden");
          charTitle.classList.toggle("open");
        };

        extraContent.appendChild(charTitle);
        extraContent.appendChild(content);
      }

      if (data.monsters.length > 0) {
        const monTitle = document.createElement("div");
        monTitle.className = "section-title";
        monTitle.innerText = "Монстры";
        const content = document.createElement("div");
        content.className = "section-content hidden";

        data.monsters.forEach(name => {
          const m = document.createElement("div");
          m.innerText = name;
          content.appendChild(m);
        });

        monTitle.onclick = () => {
          content.classList.toggle("hidden");
          monTitle.classList.toggle("open");
        };

        extraContent.appendChild(monTitle);
        extraContent.appendChild(content);
      }
    }
  </script>
</body>
</html>
