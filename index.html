<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Endless Adventure</title>
  <link href="https://fonts.googleapis.com/css2?family=Uncial+Antiqua&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #111;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
      text-align: center;
    }

    .hidden {
      opacity: 0;
      z-index: -1;
      pointer-events: none;
      transition: opacity 0.5s ease;
    }

    .hidden:not(.visible) {
      display: none;
    }

    .visible {
      opacity: 1;
      display: block;
    }

    button {
      padding: 10px 20px;
      background-color: #444;
      color: white;
      border: none;
      cursor: pointer;
      width: 200px;
    }

    .menu-button {
      display: block;
      margin: 10px auto;
    }

    #splash-dev {
      font-size: 2em;
      position: fixed;
      top: 30vh;
      width: 100%;
      transition: opacity 0.5s ease;
      z-index: 10;
    }

    #splash-dev img {
      display: block;
      width: 200px;
      height: 200px;
      min-width: 200px;
      min-height: 200px;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      background-color: #222;
      margin: 20px auto 0;
    }

    #splash-title {
      font-family: 'Uncial Antiqua', serif;
      font-size: 2em;
      font-weight: 700;
      color: #d9e4dd;
      position: fixed;
      top: 40vh;
      width: 100%;
      transition: opacity 0.5s ease;
      z-index: 10;
      white-space: normal;
      overflow-wrap: break-word;
      line-height: 1.2;
      letter-spacing: 2px;
      text-shadow: 0 0 5px rgba(217, 228, 221, 0.3), 0 0 10px rgba(217, 228, 221, 0.2);
      -webkit-text-stroke: 1px #333;
      animation: glow 2s ease-in-out infinite alternate;
    }

    @keyframes glow {
      from {
        text-shadow: 0 0 5px rgba(217, 228, 221, 0.3), 0 0 10px rgba(217, 228, 221, 0.2);
      }
      to {
        text-shadow: 0 0 8px rgba(217, 228, 221, 0.4), 0 0 12px rgba(217, 228, 221, 0.3);
      }
    }

    #main-menu {
      z-index: 5;
      transition: opacity 0.5s ease;
      padding-left: 10px;
      padding-right: 10px;
    }

    #main-menu h1 {
      white-space: normal;
      overflow-wrap: break-word;
    }

    #about-screen, #class-selection, #game-screen, #npc-dialog, #quests-screen, #inventory-screen {
      z-index: 5;
      transition: opacity 0.5s ease;
    }

    #travel-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      transition: opacity 0.5s ease;
      z-index: 20;
      flex-direction: column;
    }

    #travel-screen.visible {
      opacity: 1;
      display: flex;
    }

    #travel-timer {
      font-size: 1.5em;
      color: #f0f0f0;
    }

    #travel-text {
      font-size: 0.9em;
      color: #ccc;
      margin-top: 10px;
      text-align: center;
      max-width: 80%;
    }

    #location-desc {
      padding: 0 5px;
      text-align: justify;
    }

    #location-buttons button {
      margin: 2px;
    }

    .class-option {
      cursor: pointer;
      margin: 10px auto;
      width: 80%;
      padding: 5px;
      border: 1px solid #666;
      background-color: #222;
      transition: background-color 0.3s ease, border-color 0.3s ease, max-height 0.3s ease;
      display: flex;
      flex-direction: column;
      min-height: 70px;
      box-sizing: border-box;
    }

    .class-option.selected {
      background-color: #333;
      border-color: #888;
    }

    .class-option:hover {
      background-color: #333;
    }

    .class-name-row {
      display: flex;
      align-items: center;
      height: 70px;
    }

    .class-option img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      margin: 5px 10px;
    }

    .class-name {
      font-size: 1em;
      font-weight: bold;
      flex: 1;
      text-align: left;
      overflow-wrap: break-word;
    }

    .class-details {
      max-height: 0;
      overflow: hidden;
      margin: 0 10px 10px 10px;
      padding: 0 10px;
      background-color: #333;
      border: 1px solid #777;
      font-size: 0.95em;
      color: #ccc;
      text-align: left;
      transition: max-height 0.3s ease, opacity 0.3s ease, padding 0.3s ease;
      width: 100%;
      box-sizing: border-box;
    }

    .class-details:not(.hidden) {
      max-height: 300px;
      padding: 10px;
      opacity: 1;
    }

    .class-details p {
      margin: 5px 0;
    }

    .class-details strong {
      color: #f0f0f0;
    }

    #extra-content {
      width: 80%;
      margin: 0 auto;
    }

    .section-title {
      margin-top: 15px;
      margin-bottom: 10px;
      font-weight: bold;
      cursor: pointer;
      display: block;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .section-title::after {
      content: "\25BC";
      display: inline-block;
      margin-left: 5px;
      transition: transform 0.3s ease;
    }

    .section-title.open::after {
      transform: rotate(180deg);
    }

    .section-content {
      margin-top: 5px;
      margin-bottom: 10px;
      font-size: 0.95em;
      color: #ccc;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }

    .section-content.hidden {
      display: none;
    }

    #menu-button {
      position: fixed;
      top: 10px;
      left: 10px;
      z-index: 30;
      background-color: #444;
      border: none;
      color: white;
      font-size: 30px;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #menu-button:hover {
      background-color: #555;
    }

    #sidebar-menu {
      position: fixed;
      top: 0;
      left: 0;
      width: 66.67%;
      height: 100%;
      background-color: #333333;
      transform: translateX(-100%);
      transition: transform 0.3s ease, opacity 0.3s ease;
      z-index: 30;
      display: flex;
      flex-direction: column;
      padding: 64px 20px 20px 20px;
      box-sizing: border-box;
    }

    #sidebar-menu.open {
      transform: translateX(0);
      opacity: 1;
    }

    #sidebar-menu.open ~ #menu-button {
      display: none;
    }

    #sidebar-menu button {
      background-color: #444;
      color: #f0f0f0;
      margin: 10px 0;
      width: 100%;
      text-align: left;
      transition: background-color 0.3s ease;
      font-family: Arial, 'Segoe UI Emoji', sans-serif;
    }

    #sidebar-menu button:hover {
      background-color: #555;
    }

    #sidebar-close {
      position: fixed;
      top: 10px;
      left: 10px;
      width: 40px !important;
      height: 40px !important;
      min-width: 40px;
      min-height: 40px;
      background-color: #444;
      color: #ffffff !important;
      font-size: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
      box-sizing: border-box;
      padding: 0;
      border: none;
      overflow: hidden;
      appearance: none;
      -webkit-appearance: none;
      z-index: 30;
    }

    #sidebar-close:hover {
      background-color: #555;
    }

    #npc-dialog {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: #111;
      z-index: 25;
      transition: opacity 0.5s ease;
      box-sizing: border-box;
      padding: 20px;
      padding-bottom: 80px;
      display: grid;
      grid-template-columns: 33.33% 66.67%;
      grid-template-rows: auto auto 1fr auto;
      gap: 10px;
    }

    #npc-dialog.visible {
      opacity: 1;
      display: grid;
    }

    #npc-image {
      grid-column: 1 / 2;
      grid-row: 1 / 2;
      width: 150px;
      height: 150px;
      object-fit: cover;
      margin: 15px;
    }

    #npc-name {
      grid-column: 2 / 3;
      grid-row: 1 / 2;
      color: #f0f0f0;
      font-size: 1.8em;
      margin: 15px 15px 5px 15px;
      text-align: left;
    }

    #npc-desc {
      grid-column: 2 / 3;
      grid-row: 1 / 2;
      color: #ccc;
      font-size: 1em;
      margin: 50px 15px 15px 15px;
      text-align: left;
      max-width: 600px;
    }

    #npc-text {
      grid-column: 2 / 3;
      grid-row: 2 / 3;
      color: #f0f0f0;
      font-size: 1.1em;
      margin: 10px 15px;
      text-align: left;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    #quest-limit-msg {
      position: fixed;
      bottom: 105px;
      left: 50%;
      transform: translateX(-50%);
      color: #f88;
      font-size: 0.9em;
      margin: 0;
      width: 200px;
      text-align: center;
    }

    #npc-quest {
      position: fixed;
      bottom: 65px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #444;
      color: white;
      width: 200px;
      padding: 10px 20px;
      cursor: pointer;
      transition: background-color 0.3s ease, opacity 0.3s ease;
    }

    #npc-quest:hover:not(:disabled) {
      background-color: #555;
    }

    #npc-quest:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background-color: #333;
    }

    #npc-exit {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #444;
      color: white;
      width: 200px;
      padding: 10px 20px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    #npc-exit:hover {
      background-color: #555;
    }

    #quests-screen {
      padding: 20px;
      width: 80%;
      margin: 0 auto;
    }

    #quests-screen h2 {
      margin-bottom: 20px;
    }

    .quest-item {
      cursor: pointer;
      margin: 10px auto;
      padding: 10px;
      border: 1px solid #666;
      background-color: #222;
      transition: background-color 0.3s ease, border-color 0.3s ease;
      width: 80%;
    }

    .quest-item:hover {
      background-color: #333;
      border-color: #888;
    }

    .quest-details {
      margin-top: 5px;
      padding: 10px;
      background-color: #333;
      border: 1px solid #777;
      font-size: 0.95em;
      color: #ccc;
      text-align: left;
    }

    .quest-details.hidden {
      display: none;
    }

    #inventory-screen {
      padding: 20px;
    }

    #inventory-tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }

    .tab-button {
      background-color: #333;
      border: 1px solid #666;
      color: #f0f0f0;
      font-size: 1.5em;
      padding: 10px 20px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin: 0 5px;
    }

    .tab-button.active {
      background-color: #555;
      border-color: #888;
    }

    .tab-button:hover {
      background-color: #444;
    }

    #inventory-list {
      display: flex;
      flex-direction: column;
      width: 90%;
      max-width: 600px;
      margin: 0 auto;
    }

    .inventory-item {
      display: flex;
      align-items: center;
      height: 70px;
      background-color: #222;
      border: 1px solid #666;
      margin-bottom: 5px;
      box-sizing: border-box;
    }

    .inventory-item.empty {
      background-color: #333;
      border: 1px solid #555;
    }

    .inventory-item img {
      width: 60px;
      height: 60px;
      object-fit: cover;
      margin: 5px 10px;
    }

    .inventory-item .item-text {
      flex: 1;
      text-align: left;
      padding-right: 10px;
    }

    .inventory-item .item-name {
      font-size: 1em;
      font-weight: bold;
      overflow-wrap: break-word;
    }

    .inventory-item .item-desc {
      font-size: 0.8em;
      color: #ccc;
      overflow-wrap: break-word;
      line-height: 1.2;
    }

    #inventory-empty {
      font-size: 1em;
      color: #ccc;
      margin: 20px auto;
    }

    @media (max-width: 600px) {
      #splash-title {
        font-size: 1.5em;
        letter-spacing: 1px;
        -webkit-text-stroke: 0.5px #333;
        text-shadow: 0 0 4px rgba(217, 228, 221, 0.3), 0 0 8px rgba(217, 228, 221, 0.2);
      }

      #npc-dialog {
        grid-template-columns: 100%;
        grid-template-rows: auto auto auto 1fr;
        padding: 10px;
        padding-bottom: 80px;
      }

      #npc-image {
        grid-column: 1 / 2;
        grid-row: 1 / 2;
        width: 100px;
        height: 100px;
        margin: 10px auto;
      }

      #npc-name {
        grid-column: 1 / 2;
        grid-row: 2 / 3;
        font-size: 1.5em;
        margin: 10px;
        text-align: center;
      }

      #npc-desc {
        grid-column: 1 / 2;
        grid-row: 3 / 4;
        font-size: 0.9em;
        margin: 0 10px 10px 10px;
        text-align: center;
      }

      #npc-text {
        grid-column: 1 / 2;
        grid-row: 4 / 5;
        font-size: 1em;
        margin: 10px;
        max-height: calc(100vh - 250px);
        overflow-y: auto;
      }

      #quest-limit-msg {
        bottom: 95px;
        width: 150px;
        font-size: 0.8em;
      }

      #npc-quest {
        bottom: 55px;
        width: 150px;
      }

      #npc-exit {
        bottom: 10px;
        width: 150px;
      }

      #quests-screen {
        width: 90%;
        padding: 10px;
      }

      .quest-item {
        width: 90%;
      }

      #inventory-tabs {
        margin-bottom: 10px;
      }

      .tab-button {
        font-size: 1.2em;
        padding: 8px 15px;
        margin: 0 3px;
      }

      #inventory-list {
        width: 95%;
        max-width: 400px;
      }

      .inventory-item {
        height: 50px;
        margin-bottom: 3px;
      }

      .inventory-item img {
        width: 40px;
        height: 40px;
        margin: 5px 8px;
      }

      .inventory-item .item-name {
        font-size: 0.9em;
      }

      .inventory-item .item-desc {
        font-size: 0.7em;
      }

      .class-option {
        min-height: 50px;
        padding: 3px;
      }

      .class-name-row {
        height: 50px;
      }

      .class-option img {
        width: 40px;
        height: 40px;
        margin: 5px 8px;
      }

      .class-name {
        font-size: 0.9em;
      }

      .class-details {
        font-size: 0.85em;
        padding: 0 8px;
        margin: 0 8px 8px 8px;
      }

      .class-details:not(.hidden) {
        padding: 8px;
      }
    }
  </style>
</head>
<body>
  <div id="inventory-screen" class="hidden">
    <h2>Инвентарь</h2>
    <div id="inventory-tabs">
      <button class="tab-button" data-tab="weapons">⚔️</button>
      <button class="tab-button" data-tab="armor">🛡️</button>
      <button class="tab-button" data-tab="potions">🧪</button>
      <button class="tab-button" data-tab="keyItems">🔑</button>
    </div>
    <div id="inventory-list"></div>
    <p id="inventory-empty" class="hidden">Раздел пуст</p>
    <button onclick="backToGame()">Назад</button>
  </div>

  <div id="menu-button" onclick="toggleMenu()"><span>☰</span></div>
  <div id="sidebar-menu" class="hidden">
    <button id="sidebar-close" onclick="toggleMenu()">✖</button>
    <button id="sidebar-about-character" onclick="showAboutCharacter()">ℹ️ Об игроке</button>
    <button onclick="showInventory()">🎒 Инвентарь</button>
    <button onclick="showSkills()">⚔️ Умения</button>
    <button onclick="showQuests()">📜 Квесты</button>
  </div>
  <div id="splash-dev">
    Murmyak Games
    <img src="logo.png" alt="Murmyak Games Logo">
  </div>
  <div id="splash-title" class="hidden">Endless Adventure</div>

  <div id="main-menu" class="hidden">
    <h1>Endless Adventure</h1>
    <div class="menu-button">
      <button onclick="newGame()">Новая игра</button>
    </div>
    <div class="menu-button">
      <button onclick="continueGame()">Продолжить игру</button>
    </div>
    <div class="menu-button">
      <button onclick="showAbout()">Об игре</button>
    </div>
  </div>

  <div id="about-screen" class="hidden">
    <h2>Об игре</h2>
    <p>by merzlyakov</p>
    <button onclick="backToMenu()">Назад</button>
  </div>

  <div id="class-selection" class="hidden">
    <h2>Выберите класс</h2>
    <div class="class-option" data-class="archer" onclick="toggleClassInfo(this)">
      <div class="class-name-row">
        <img src="archer.png" alt="Следопыт">
        <div class="class-name">Следопыт</div>
      </div>
      <div class="class-details hidden">
        <p><strong>Описание:</strong> Искры глаз следят за каждым движением в чаще, а стрелы бьют без промаха.</p>
        <p><strong>Особенность:</strong> Перемещается на 10% быстрее.</p>
        <p><strong>Снаряжение:</strong> Лук, Кожаная броня, Кольчужный капюшон, Зелье здоровья, Походные сапоги.</p>
      </div>
    </div>
    <div class="class-option" data-class="warrior" onclick="toggleClassInfo(this)">
      <div class="class-name-row">
        <img src="warrior.png" alt="Воин">
        <div class="class-name">Воин</div>
      </div>
      <div class="class-details hidden">
        <p><strong>Описание:</strong> Сильный и выносливый боец, готовый стоять до последнего.</p>
        <p><strong>Особенность:</strong> Получает на 15% меньше урона.</p>
        <p><strong>Снаряжение:</strong> Меч, Щит, Стальная броня, Зелье здоровья, Походные сапоги.</p>
      </div>
    </div>
    <div class="class-option" data-class="rogue" onclick="toggleClassInfo(this)">
      <div class="class-name-row">
        <img src="rogue.png" alt="Разбойник">
        <div class="class-name">Разбойник</div>
      </div>
      <div class="class-details hidden">
        <p><strong>Описание:</strong> Тень, что крадётся в ночи, с клинком, готовым к удару.</p>
        <p><strong>Особенность:</strong> Наносит на 20% больше урона при скрытной атаке.</p>
        <p><strong>Снаряжение:</strong> Кинжалы, Плащ теней, Маска, Зелье здоровья, Походные сапоги.</p>
      </div>
    </div>
    <button onclick="selectClass()">Выбрать</button>
  </div>

  <div id="game-screen" class="hidden">
    <h2 id="location-name"></h2>
    <p id="location-desc"></p>
    <div id="location-buttons"></div>
    <div id="extra-content"></div>
  </div>

  <div id="travel-screen" class="hidden">
    <div id="travel-timer">Вы идёте...</div>
    <p id="travel-text"></p>
  </div>

  <div id="npc-dialog" class="hidden">
    <img id="npc-image" src="" alt="NPC">
    <h2 id="npc-name"></h2>
    <p id="npc-desc"></p>
    <p id="npc-text"></p>
    <p id="quest-limit-msg" class="hidden">
      У вас не может больше четырёх активных квестов. Сначала завершите уже начатые квесты.
    </p>
    <button id="npc-quest" onclick="takeQuest()">Взять задание</button>
    <button id="npc-exit" onclick="closeNpcDialog()">Выйти</button>
  </div>

  <div id="quests-screen" class="hidden">
    <h2>Квесты</h2>
    <div id="quests-list"></div>
    <button onclick="backToGame()">Назад</button>
  </div>

  <script>
    // Данные NPC
    const npcData = {
      "Староста Лем": {
        text: "Наш гонец ушёл с письмом к соседнему поселению, но так и не вернулся. Он не из тех, кто задерживается без причины... Пожалуйста, разыщи его. Я боюсь худшего.",
        desc: "Мудрый глава деревни, чьи глаза хранят тревогу за свой народ.",
        image: "oldman.jpg"
      },
      "Кузнец Бран": {
        text: "Без хорошего угля я не смогу ковать ни меча, ни подкову. Шахта к югу опустела, но уголь там всё ещё есть. Добудь немного — и я отблагодарю.",
        desc: "Грубый, но мастеровитый кузнец, чьи руки создают оружие легенд.",
        image: "blacksmith.jpg"
      },
      "Охотница Элира": {
        text: "Я нашла следы — крупные, с кровью. Это не волк. Что-то убивает зверей и пугает лес. Я иду на охоту. Не хочешь пойти со мной? Вдвоём у нас больше шансов.",
        desc: "Ловкая следопытка, чьё сердце принадлежит дикому лесу.",
        image: "hunter.jpg"
      },
      "Рыбак Нор": {
        text: "Я видел его — огромный, с усами, как у старого мудреца. Сомавр снова в пруду. Никто не может его вытащить. А ты попробуй... вдруг повезёт?",
        desc: "Седой рыбак, знающий тайны реки и её духов.",
        image: "fisherman.jpg"
      },
      "Мудрая жаба": {
        text: "Пей больше воды и высыпайся.",
        desc: "Она знает больше, чем кажется, и всегда говорит по делу.",
        image: "toad.jpg"
      },
      "Страж Ролан": {
        text: "Я на посту каждую ночь, и всё чаще слышу шаги наверху, когда башня должна быть пуста... Проверь это за меня. Я не могу уйти с поста.",
        desc: "Суровый воин, верный своему долгу охранять башню.",
        image: "guard.jpg"
      },
      "Старец Вейн": {
        text: "Заклятие рассыпается, как песок сквозь пальцы... Мне нужна одна старая книга. Её хранят руины на востоке. Опасное место, но ты справишься. Я чувствую это.",
        desc: "Хранитель озёрных легенд, чей взор устремлён в глубины.",
        image: "elder.jpg"
      },
      "Скиталец Кайр": {
        text: "Люди исчезают на старом тракте. Без шума, без следа. Я слышу шорохи в ночи, не похожие на зверей. Пройди по той дороге... но будь готов к теням.",
        desc: "Бродяга с острым умом, знающий каждый уголок каньона.",
        image: "wanderer.jpg"
      },
      "Комендант Рейн": {
        text: "Кто-то из моих стражей что-то скрывает. Я вижу взгляды, слышу шёпоты. Мне нужен тот, кому я могу доверять. Помоги мне выяснить правду — пока не поздно.",
        desc: "Бывший лидер крепости, жаждущий вернуть её былую славу.",
        image: "commander.jpg"
      }
    };

    // Данные квестов (без Мудрой жабы)
    const questData = {
      "Староста Лем": {
        title: "Пропавший гонец",
        desc: "Найди вестника в лесу",
        condition: "Найти и вернуть гонца живым",
        reward: "20 монет, +доверие деревни"
      },
      "Кузнец Бран": {
        title: "Угли для кузни",
        desc: "Добыть уголь в шахте",
        condition: "Принести 5 единиц угля",
        reward: "Прочный меч или броня"
      },
      "Охотница Элира": {
        title: "Тропами зверя",
        desc: "Убей вурдалака в лесу",
        condition: "Победить вурдалака в лесу",
        reward: "Охотничий плащ (+ловкость)"
      },
      "Рыбак Нор": {
        title: "Большая рыба",
        desc: "Поймай редкого сомавра",
        condition: "Поймать и принести сомавра",
        reward: "Серебряный крючок (+удача в рыбалке)"
      },
      "Страж Ролан": {
        title: "Тихая башня",
        desc: "Проверь странные звуки ночью",
        condition: "Выследить и устранить нарушителя",
        reward: "Доспех стража (+защита)"
      },
      "Старец Вейн": {
        title: "Пыль времён",
        desc: "Найди древнюю книгу в руинах",
        condition: "Принести книгу из старого храма",
        reward: "Свиток заклинания или мана-камень"
      },
      "Скиталец Кайр": {
        title: "Следы теней",
        desc: "Расследуй исчезновения на дороге",
        condition: "Победить теневого врага на тракте",
        reward: "Плащ теней (+уклонение)"
      },
      "Комендант Рейн": {
        title: "Запах мятежа",
        desc: "Раскрой заговор в крепости",
        condition: "Выявить и разоблачить заговорщиков",
        reward: "Орден коменданта (+влияние)"
      }
    };

    // Тексты для экрана перехода
    const travelTexts = {
      "Деревня": "Тепло очагов зовёт путника домой...",
      "Лес": "Тени шепчут в чаще, скрывая путь...",
      "Река": "Я в своем познании настолько преисполнился...",
      "Горы": "Ветер несёт эхо древних битв...",
      "Поляна": "Звёзды над поляной предвещают судьбу...",
      "Пещера": "Тьма пещеры хранит забытые тайны...",
      "Развалины": "Камни помнят славу ушедших эпох...",
      "Башня": "Эфир кружит у стен одинокой башни...",
      "Храм": "Свет вечного огня манит вперёд...",
      "Портал": "Иные миры ждут за гранью света...",
      "Озеро": "Гладь озера скрывает древние секреты...",
      "Болото": "Туман болот таит смертельные ловушки...",
      "Каньон": "Красные скалы хранят знаки предков...",
      "Равнина": "Травы шепчут о героях прошлого...",
      "Крепость": "Стены крепости помнят клятвы рыцарей..."
    };

    // Иконки для предметов
    const itemIcons = {
      "Зелье здоровья": "healthpotion.png",
      "Походные сапоги": "boots.png",
      "Лук": "bow.png",
      "Кожаная броня": "leatherarmor.png",
      "Кольчужный капюшон": "chainhood.png",
      "Меч": "sword.png",
      "Щит": "shield.png",
      "Стальная броня": "steelarmor.png",
      "Кинжалы": "daggers.png",
      "Плащ теней": "shadowcloak.png",
      "Маска": "mask.png"
    };

    // Описания предметов
    const itemDescriptions = {
      "Зелье здоровья": "Восстанавливает 50 единиц здоровья при использовании.",
      "Походные сапоги": "Увеличивают скорость передвижения на 10%.",
      "Лук": "Оружие дальнего боя, наносит 15 урона.",
      "Кожаная броня": "Лёгкая броня, добавляет 10 защиты.",
      "Кольчужный капюшон": "Защищает голову, добавляет 5 защиты.",
      "Меч": "Мощное оружие ближнего боя, наносит 20 урона.",
      "Щит": "Блокирует 30% входящего урона.",
      "Стальная броня": "Тяжёлая броня, добавляет 20 защиты.",
      "Кинжалы": "Быстрое оружие, наносит 12 урона с шансом критического удара.",
      "Плащ теней": "Увеличивает уклонение на 15%.",
      "Маска": "Скрывает личность, повышает скрытность."
    };

    // Данные классов
    const classData = {
      archer: {
        name: "Следопыт",
        image: "archer.png",
        desc: "Искры глаз следят за каждым движением в чаще, а стрелы бьют без промаха.",
        feature: "Перемещается на 10% быстрее.",
        equipment: ["Лук", "Кожаная броня", "Кольчужный капюшон", "Зелье здоровья", "Походные сапоги"]
      },
      warrior: {
        name: "Воин",
        image: "warrior.png",
        desc: "Сильный и выносливый боец, готовый стоять до последнего.",
        feature: "Получает на 15% меньше урона.",
        equipment: ["Меч", "Щит", "Стальная броня", "Зелье здоровья", "Походные сапоги"]
      },
      rogue: {
        name: "Разбойник",
        image: "rogue.png",
        desc: "Тень, что крадётся в ночи, с клинком, готовым к удару.",
        feature: "Наносит на 20% больше урона при скрытной атаке.",
        equipment: ["Кинжалы", "Плащ теней", "Маска", "Зелье здоровья", "Походные сапоги"]
      }
    };

    // Сброс всех экранов
    function resetScreens() {
      document.querySelectorAll("#splash-dev, #splash-title, #main-menu, #about-screen, #class-selection, #game-screen, #travel-screen, #npc-dialog, #quests-screen, #inventory-screen")
        .forEach(el => {
          el.classList.remove("visible");
          el.classList.add("hidden");
        });
      document.getElementById("sidebar-menu").classList.remove("open");
      document.getElementById("menu-button").classList.add("hidden");
    }

    // Управление боковым меню
    function closeMenuOnOutsideClick(event) {
      const sidebar = document.getElementById("sidebar-menu");
      const menuButton = document.getElementById("menu-button");
      const sidebarClose = document.getElementById("sidebar-close");
      if (sidebar.classList.contains("open") &&
          !event.target.closest("#sidebar-menu") &&
          !event.target.closest("#menu-button") &&
          !event.target.closest("#sidebar-close")) {
        toggleMenu();
      }
    }

    function toggleMenu() {
      const sidebar = document.getElementById("sidebar-menu");
      sidebar.classList.toggle("open");
      if (sidebar.classList.contains("open")) {
        sidebar.classList.remove("hidden");
        sidebar.classList.add("visible");
        document.addEventListener("click", closeMenuOnOutsideClick);
      } else {
        sidebar.classList.remove("visible");
        document.removeEventListener("click", closeMenuOnOutsideClick);
        setTimeout(() => {
          if (!sidebar.classList.contains("open")) {
            sidebar.classList.add("hidden");
          }
        }, 300);
      }
    }

    // Экран разговора с NPC
    let currentNpc = null;

    function showNpcDialog(name) {
      resetScreens();
      const dialog = document.getElementById("npc-dialog");
      document.getElementById("npc-name").innerText = name;
      document.getElementById("npc-desc").innerText = npcData[name].desc;
      document.getElementById("npc-text").innerText = npcData[name].text;
      document.getElementById("npc-image").src = npcData[name].image;
      currentNpc = name;

      const questButton = document.getElementById("npc-quest");
      const questLimitMsg = document.getElementById("quest-limit-msg");

      if (name === "Мудрая жаба") {
        questButton.classList.add("hidden");
        questLimitMsg.classList.add("hidden");
      } else {
        const alreadyTaken = playerData.quests.find(q => q.npc === name);
        const tooManyQuests = playerData.quests.length >= 4;

        if (alreadyTaken) {
          questButton.classList.add("hidden");
          questLimitMsg.classList.add("hidden");
        } else if (tooManyQuests) {
          questButton.disabled = true;
          questButton.classList.remove("hidden");
          questLimitMsg.classList.remove("hidden");
        } else {
          questButton.disabled = false;
          questButton.classList.remove("hidden");
          questLimitMsg.classList.add("hidden");
        }
      }

      dialog.classList.remove("hidden");
      dialog.classList.add("visible");
    }

    function closeNpcDialog() {
      resetScreens();
      document.getElementById("game-screen").classList.remove("hidden");
      document.getElementById("game-screen").classList.add("visible");
      document.getElementById("menu-button").classList.remove("hidden");
      document.getElementById("menu-button").classList.add("visible");
      currentNpc = null;
      updateLocation();
    }

    function takeQuest() {
      if (currentNpc && questData[currentNpc]) {
        const quest = questData[currentNpc];
        if (!playerData.quests.find(q => q.npc === currentNpc) && playerData.quests.length < 4) {
          playerData.quests.push({
            npc: currentNpc,
            title: quest.title,
            desc: quest.desc,
            condition: quest.condition,
            reward: quest.reward
          });
          saveGame();
        }
        closeNpcDialog();
      }
    }

    // Экран квестов
    function showQuests() {
      resetScreens();
      const questsScreen = document.getElementById("quests-screen");
      const questsList = document.getElementById("quests-list");
      questsList.innerHTML = "";

      if (playerData.quests.length === 0) {
        questsList.innerHTML = '<p>У вас еще нет заданий. Походите по округ и поговорите с людьми - может кому-то нужна помощь.</p>';
      } else {
        playerData.quests.forEach((quest, index) => {
          const questItem = document.createElement("div");
          questItem.className = "quest-item";
          questItem.innerHTML = `
            <strong>${quest.title}</strong>
            <div>${quest.desc}</div>
            <div class="quest-details hidden" id="quest-details-${index}">
              <p><strong>Условие:</strong> ${quest.condition}</p>
              <p><strong>Награда:</strong> ${quest.reward}</p>
            </div>
          `;
          questItem.addEventListener("click", (e) => {
            e.stopPropagation();
            const details = document.getElementById(`quest-details-${index}`);
            const isHidden = details.classList.contains("hidden");
            document.querySelectorAll(".quest-details").forEach(d => d.classList.add("hidden"));
            if (isHidden) {
              details.classList.remove("hidden");
            }
          });
          questsList.appendChild(questItem);
        });
      }

      questsScreen.classList.remove("hidden");
      questsScreen.classList.add("visible");
      document.getElementById("menu-button").classList.remove("hidden");
      document.getElementById("menu-button").classList.add("visible");

      document.addEventListener("click", closeQuestDetailsOnOutsideClick);
    }

    function closeQuestDetailsOnOutsideClick(event) {
      if (!event.target.closest(".quest-item")) {
        document.querySelectorAll(".quest-details").forEach(d => d.classList.add("hidden"));
      }
    }

    function backToGame() {
      resetScreens();
      document.getElementById("game-screen").classList.remove("hidden");
      document.getElementById("game-screen").classList.add("visible");
      document.getElementById("menu-button").classList.remove("hidden");
      document.getElementById("menu-button").classList.add("visible");
      document.removeEventListener("click", closeQuestDetailsOnOutsideClick);
      updateLocation();
    }

    // Заглушки для других кнопок меню
    function showAboutCharacter() {
      alert("Раздел 'Об игроке' в разработке!");
    }

    function showInventory() {
      resetScreens();
      const inventoryScreen = document.getElementById("inventory-screen");
      const inventoryList = document.getElementById("inventory-list");
      const inventoryEmpty = document.getElementById("inventory-empty");
      const tabs = document.querySelectorAll(".tab-button");

      // По умолчанию показываем раздел оружия
      let currentTab = "weapons";
      tabs.forEach(tab => {
        tab.classList.remove("active");
        if (tab.dataset.tab === currentTab) {
          tab.classList.add("active");
        }
      });

      function renderInventory(tab) {
        inventoryList.innerHTML = "";
        const items = playerData.inventory[tab] || [];
        inventoryEmpty.classList.add("hidden");

        if (items.length === 0) {
          inventoryEmpty.classList.remove("hidden");
        } else {
          for (let i = 0; i < 10; i++) {
            const item = items[i];
            const itemElement = document.createElement("div");
            itemElement.className = "inventory-item" + (item ? "" : " empty");
            if (item) {
              itemElement.innerHTML = `
                <img src="${itemIcons[item]}" alt="${item}">
                <div class="item-text">
                  <div class="item-name">${item}</div>
                  <div class="item-desc">${itemDescriptions[item]}</div>
                </div>
              `;
            }
            inventoryList.appendChild(itemElement);
          }
        }
      }

      // Начальный рендеринг
      renderInventory(currentTab);

      // Обработчики вкладок
      tabs.forEach(tab => {
        tab.addEventListener("click", () => {
          currentTab = tab.dataset.tab;
          tabs.forEach(t => t.classList.remove("active"));
          tab.classList.add("active");
          renderInventory(currentTab);
        });
      });

      inventoryScreen.classList.remove("hidden");
      inventoryScreen.classList.add("visible");
      document.getElementById("menu-button").classList.remove("hidden");
      document.getElementById("menu-button").classList.add("visible");
    }

    function showSkills() {
      alert("Раздел 'Умения' в разработке!");
    }

    // Splash-экраны
    resetScreens();
    document.getElementById("splash-dev").classList.remove("hidden");
    document.getElementById("splash-dev").classList.add("visible");

    setTimeout(() => {
      document.getElementById("splash-dev").classList.remove("visible");
      document.getElementById("splash-dev").classList.add("hidden");
      setTimeout(() => {
        resetScreens();
        document.getElementById("splash-title").classList.remove("hidden");
        document.getElementById("splash-title").classList.add("visible");
        setTimeout(() => {
          document.getElementById("splash-title").classList.remove("visible");
          document.getElementById("splash-title").classList.add("hidden");
          setTimeout(() => {
            resetScreens();
            document.getElementById("main-menu").classList.remove("hidden");
            document.getElementById("main-menu").classList.add("visible");
          }, 500);
        }, 3000);
      }, 500);
    }, 3000);

    // Состояние игры
    let playerData = {
      class: null,
      location: "Деревня",
      quests: [],
      inventory: {
        weapons: [],
        armor: [],
        potions: [],
        keyItems: []
      }
    };

    // Расстояния от Деревни
    const locationDistances = {
      "Деревня": 0,
      "Лес": 1,
      "Река": 1,
      "Горы": 2,
      "Поляна": 2,
      "Пещера": 2,
      "Развалины": 3,
      "Башня": 3,
      "Храм": 4,
      "Портал": 5,
      "Озеро": 2,
      "Болото": 3,
      "Каньон": 3,
      "Равнина": 4,
      "Крепость": 5
    };

    // Названия локаций в винительном падеже
    const locationAccusative = {
      "Деревня": "Деревню",
      "Лес": "Лес",
      "Река": "Реку",
      "Горы": "Горы",
      "Поляна": "Поляну",
      "Пещера": "Пещеру",
      "Развалины": "Развалины",
      "Башня": "Башню",
      "Храм": "Храм",
      "Портал": "Портал",
      "Озеро": "Озеро",
      "Болото": "Болото",
      "Каньон": "Каньон",
      "Равнина": "Равнину",
      "Крепость": "Крепость"
    };

    // Классы
    function toggleClassInfo(element) {
      const options = document.querySelectorAll(".class-option");
      options.forEach(opt => {
        const details = opt.querySelector(".class-details");
        opt.classList.remove("selected");
        details.classList.add("hidden");
      });
      const details = element.querySelector(".class-details");
      details.classList.toggle("hidden");
      if (!details.classList.contains("hidden")) {
        element.classList.add("selected");
      }
    }

    function newGame() {
      playerData = {
        class: null,
        location: "Деревня",
        quests: [],
        inventory: {
          weapons: [],
          armor: [],
          potions: [],
          keyItems: []
        }
      };
      resetScreens();
      document.getElementById("class-selection").classList.remove("hidden");
      document.getElementById("class-selection").classList.add("visible");
      document.querySelectorAll(".class-option").forEach(opt => {
        opt.classList.remove("selected");
        opt.querySelector(".class-details").classList.add("hidden");
      });
    }

    function continueGame() {
      const data = localStorage.getItem("mygame-save");
      if (data) {
        playerData = JSON.parse(data);
        startGame();
      } else {
        alert("Сохранённой игры не найдено. Начните новую игру.");
      }
    }

    function showAbout() {
      resetScreens();
      document.getElementById("about-screen").classList.remove("hidden");
      document.getElementById("about-screen").classList.add("visible");
    }

    function backToMenu() {
      resetScreens();
      document.getElementById("main-menu").classList.remove("hidden");
      document.getElementById("main-menu").classList.add("visible");
    }

    function selectClass() {
      if (!playerData.class) {
        const selectedOption = document.querySelector(".class-option .class-details:not(.hidden)");
        const selectedClass = selectedOption
          ? selectedOption.closest(".class-option").dataset.class
          : "warrior";
        playerData.class = selectedClass;
      }

      // Добавляем начальные предметы
      const classInfo = classData[playerData.class];
      playerData.inventory.potions.push("Зелье здоровья");
      playerData.inventory.keyItems.push("Походные сапоги");

      if (playerData.class === "archer") {
        playerData.inventory.weapons.push("Лук");
        playerData.inventory.armor.push("Кожаная броня", "Кольчужный капюшон");
      } else if (playerData.class === "warrior") {
        playerData.inventory.weapons.push("Меч");
        playerData.inventory.armor.push("Щит", "Стальная броня");
      } else if (playerData.class === "rogue") {
        playerData.inventory.weapons.push("Кинжалы");
        playerData.inventory.armor.push("Плащ теней");
        playerData.inventory.keyItems.push("Маска");
      }

      saveGame();
      resetScreens();
      startGame();
    }

    function startGame() {
      resetScreens();
      document.getElementById("game-screen").classList.remove("hidden");
      document.getElementById("game-screen").classList.add("visible");
      document.getElementById("menu-button").classList.remove("hidden");
      document.getElementById("menu-button").classList.add("visible");
      updateLocation();
    }

    function saveGame() {
      localStorage.setItem("mygame-save", JSON.stringify(playerData));
    }

    function showTravelScreen(targetLocation, duration) {
      resetScreens();
      const travelScreen = document.getElementById("travel-screen");
      const travelTimer = document.getElementById("travel-timer");
      const travelText = document.getElementById("travel-text");
      travelScreen.classList.remove("hidden");
      travelScreen.classList.add("visible");
      let timeLeft = Math.ceil(duration / 1000);
      travelTimer.innerText = `Вы идёте в ${locationAccusative[targetLocation]}... ${timeLeft} сек`;
      travelText.innerText = travelTexts[targetLocation] || "Путь манит вперёд...";

      const interval = setInterval(() => {
        timeLeft--;
        if (timeLeft > 0) {
          travelTimer.innerText = `Вы идёте в ${locationAccusative[targetLocation]}... ${timeLeft} сек`;
        } else {
          clearInterval(interval);
          playerData.location = targetLocation;
          saveGame();
          resetScreens();
          document.getElementById("game-screen").classList.remove("hidden");
          document.getElementById("game-screen").classList.add("visible");
          document.getElementById("menu-button").classList.remove("hidden");
          document.getElementById("menu-button").classList.add("visible");
          updateLocation();
        }
      }, 1000);
    }

    // Локации
    const locations = {
      "Деревня": {
        desc: "Тихая деревня, окружённая старыми дубами. Каменные дома хранят истории о древних героях, а в таверне шепчутся о проклятых землях.",
        paths: ["Лес", "Река"],
        characters: ["Староста Лем", "Кузнец Бран"],
        monsters: []
      },
      "Лес": {
        desc: "Тёмный лес, где ветви сплетаются в узоры. Туман скрывает тропы, а шорохи намекают на присутствие духов.",
        paths: ["Деревня", "Горы", "Поляна"],
        characters: ["Охотница Элира"],
        monsters: ["Древесный ужас", "Тенелис"]
      },
      "Река": {
        desc: "Река с ледяной водой, чьи волны поют о забытых богах. На берегу видны следы древних алтарей.",
        paths: ["Деревня", "Пещера", "Озеро"],
        characters: ["Рыбак Нор"],
        monsters: ["Водяная тварь"]
      },
      "Горы": {
        desc: "Суровые горы, чьи вершины касаются звёзд. Скалы хранят эхо битв давно ушедших времён.",
        paths: ["Лес", "Развалины", "Каньон"],
        characters: [],
        monsters: ["Горный голем"]
      },
      "Поляна": {
        desc: "Лунная поляна, где свет звёзд создаёт магические узоры. Здесь время замирает, а духи шепчут пророчества.",
        paths: ["Лес", "Башня"],
        characters: [],
        monsters: []
      },
      "Пещера": {
        desc: "Мрачная пещера, где сталактиты блестят, как клыки. В глубине слышны стоны заточённых теней.",
        paths: ["Река", "Развалины", "Болото"],
        characters: [],
        monsters: ["Слизень", "Пещерный паук"]
      },
      "Развалины": {
        desc: "Останки древнего города, где ветер несёт отголоски былой славы. Камни хранят следы магических рун.",
        paths: ["Горы", "Пещера", "Храм"],
        characters: [],
        monsters: ["Призрак легиона"]
      },
      "Башня": {
        desc: "Одинокая башня, окружённая вихрями эфира. Её стены хранят тайны последнего мага.",
        paths: ["Поляна", "Храм"],
        characters: ["Страж Ролан"],
        monsters: []
      },
      "Храм": {
        desc: "Храм, чьи колонны покрыты мхом. Внутри горит вечный огонь, охраняемый невидимыми стражами.",
        paths: ["Башня", "Развалины", "Портал", "Крепость"],
        characters: [],
        monsters: ["Служитель Тени"]
      },
      "Портал": {
        desc: "Круг камней, излучающий неземной свет. Портал манит в иные миры, но его стражи не терпят слабых.",
        paths: ["Храм"],
        characters: [],
        monsters: ["Страж Бездны"]
      },
      "Озеро": {
        desc: "Спокойное озеро, чья гладь отражает звёзды. В глубинах таятся древние реликвии и их хранители.",
        paths: ["Река", "Болото"],
        characters: ["Старец Вейн"],
        monsters: ["Озёрный дух"]
      },
      "Болото": {
        desc: "Гнилое болото, где тени танцуют в тумане. Трясина скрывает кости тех, кто искал запретные сокровища.",
        paths: ["Озеро", "Пещера"],
        characters: ["Мудрая жаба"],
        monsters: ["Болотный призрак", "Гнилец"]
      },
      "Каньон": {
        desc: "Красный каньон, высеченный ветрами веков. Его стены покрыты знаками древних племён.",
        paths: ["Горы", "Равнина"],
        characters: ["Скиталец Кайр"],
        monsters: ["Песчаный ящер"]
      },
      "Равнина": {
        desc: "Бескрайняя равнина, где травы шепчут о забытых битвах. Вдалеке виднеются силуэты древних курганов.",
        paths: ["Каньон", "Крепость"],
        characters: [],
        monsters: ["Степной волк"]
      },
      "Крепость": {
        desc: "Полуразрушенная крепость, чьи башни всё ещё стоят. В её залах звучат отголоски рыцарских клятв.",
        paths: ["Равнина", "Храм"],
        characters: ["Комендант Рейн"],
        monsters: ["Оживший доспех"]
      }
    };

    function updateLocation() {
      const loc = playerData.location;
      const data = locations[loc];
      document.getElementById("location-name").innerText = loc;
      document.getElementById("location-desc").innerText = data.desc;

      const buttons = document.getElementById("location-buttons");
      buttons.innerHTML = "";

      data.paths.forEach(path => {
        const btn = document.createElement("button");
        btn.innerText = path;
        btn.onclick = () => {
          const distance = locationDistances[path];
          const travelTime = Math.min(distance * 5000, 15000);
          showTravelScreen(path, travelTime);
        };
        buttons.appendChild(btn);
      });

      const extraContent = document.getElementById("extra-content");
      extraContent.innerHTML = "";

      if (data.characters.length > 0) {
        const charTitle = document.createElement("div");
        charTitle.className = "section-title";
        charTitle.innerText = "Персонажи";
        const content = document.createElement("div");
        content.className = "section-content hidden";

        data.characters.forEach(name => {
          const btn = document.createElement("button");
          btn.innerText = name;
          btn.style.width = "100%";
          btn.style.margin = "5px 0";
          btn.onclick = () => showNpcDialog(name);
          content.appendChild(btn);
        });

        charTitle.onclick = () => {
          content.classList.toggle("hidden");
          charTitle.classList.toggle("open");
        };

        extraContent.appendChild(charTitle);
        extraContent.appendChild(content);
      }

      if (data.monsters.length > 0) {
        const monTitle = document.createElement("div");
        monTitle.className = "section-title";
        monTitle.innerText = "Монстры";
        const content = document.createElement("div");
        content.className = "section-content hidden";

        data.monsters.forEach(name => {
          const m = document.createElement("div");
          m.innerText = name;
          content.appendChild(m);
        });

        monTitle.onclick = () => {
          content.classList.toggle("hidden");
          monTitle.classList.toggle("open");
        };

        extraContent.appendChild(monTitle);
        extraContent.appendChild(content);
      }
    }
  </script>
</body>
</html>